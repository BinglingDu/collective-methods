# Richard's experiments with Beautiful Soup
----
###### Downloading the newest image from a Xiaomi Yi camera
To be used in conjunction with [this Xiaomi Yi library](https://github.com/deltaflyer4747/Xiaomi_Yi)

````python
import os, re, sys, time, socket, urllib2
from settings import camaddr
from settings import camport
from bs4 import BeautifulSoup

# by default, the script fetches the newest image from this directory and 
# process it for usage in processing. 

def takeXiaoyiPhoto():
    global url
    url = "http://192.168.42.1/DCIM/100MEDIA/"
    srv = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    srv.connect((camaddr, camport))
    srv.send('{"msg_id":257,"token":0}')

    data = srv.recv(512)
    print data
    if "rval" in data:
    	token = re.findall('"param": (.+) }',data)[0]	
    else:
	    data = srv.recv(512)
	    if "rval" in data:
		    token = re.findall('"param": (.+) }',data)[0]	


    tosend = '{"msg_id":769,"token":%s}' %token
    srv.send(tosend)
    srv.recv(512)
    time.sleep(1)

def parseUrl():
    html = urllib2.urlopen(url).read()

    soup = BeautifulSoup(html, "html.parser")

    last_link = soup.find_all('a', href=True)[-1]
    filename = re.sub('<[^>]*>', '', str(last_link))
    print "the file name is" + filename
    print url + filename + " downloading with urllib2"
    f = urllib2.urlopen(url + filename)
    data = f.read()
    with open(filename, "wb") as code:
        code.write(data)
    
takeXiaoyiPhoto()
parseUrl()
````
